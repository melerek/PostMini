# PostMini v1.6.0 - Request Folders & Collection Variables

**Release Date:** January 21, 2025

## 🎯 Overview

Version 1.6.0 introduces powerful organizational features that bring PostMini closer to enterprise-grade API testing tools. This release focuses on improved request organization through hierarchical folders and collection-level variable management.

## ✨ Major Features

### 1. **Hierarchical Request Folders** 📁

Organize your API requests with unlimited nested folders within collections.

**Key Features:**
- ✅ Create folders and subfolders within collections
- ✅ Nest folders to any depth for complex API structures
- ✅ Move requests between folders via context menu
- ✅ Folder item counts showing total subfolders and requests
- ✅ Dynamic folder icons (open/closed states)
- ✅ Full context menu support (Add Folder, Add Request, Rename, Delete, Move)
- ✅ Cascade deletion - deleting a folder removes all its contents

**How to Use:**
1. Right-click on a collection → "Add Folder"
2. Right-click on a folder → "Add Subfolder" or "Add Request"
3. Right-click on a request → "Move to" → Select destination folder
4. Folders display counts: `Folder Name [2] [5]` (2 subfolders, 5 requests)

**Use Cases:**
```
📦 User API Collection
  📁 Authentication [0] [3]
    [POST] Login
    [POST] Register
    [POST] Logout
  📁 User Management [2] [0]
    📁 Profile [0] [4]
      [GET] Get Profile
      [PUT] Update Profile
      [POST] Upload Avatar
      [DELETE] Delete Account
    📁 Settings [0] [2]
      [GET] Get Settings
      [PATCH] Update Settings
```

### 2. **Collection Variables** 🔧

Define reusable variables at the collection level with a clear resolution hierarchy.

**Key Features:**
- ✅ Collection-scoped variables with key-value pairs
- ✅ Descriptions for documentation
- ✅ Variable resolution hierarchy: **Collection > Environment > Dynamic**
- ✅ Dedicated UI dialog for managing collection variables
- ✅ Support for all variable formats: `{{variable}}` and `$dynamic`
- ✅ Database-backed with unique key constraints

**Variable Resolution Hierarchy:**
1. **Collection Variables** - Highest priority, overrides all others
2. **Environment Variables** - Second priority
3. **Dynamic Variables** - Lowest priority (`$guid`, `$timestamp`, etc.)

**How to Use:**
1. Right-click on a collection → "Manage Variables"
2. Add key-value pairs:
   - Key: `base_url`
   - Value: `https://api.example.com/v2`
   - Description: "Production API endpoint"
3. Use in requests: `{{base_url}}/users`
4. Collection variables override environment variables automatically

**Use Cases:**
- API version management (`{{api_version}}`)
- Collection-specific base URLs
- Common request IDs or tokens
- Test data specific to a collection

### 3. **Visual Enhancements** 🎨

**Colored Method Badges:**
- Method badges now displayed in color: `[GET]`, `[POST]`, `[DELETE]`, etc.
- Request names in consistent gray color for clean appearance
- Color coding:
  - 🟢 `[GET]` - Teal
  - 🟠 `[POST]` - Orange
  - 🔵 `[PUT]` - Blue
  - 🟡 `[PATCH]` - Yellow
  - 🔴 `[DELETE]` - Red
  - ⚪ `[HEAD]` - Gray
  - 🟣 `[OPTIONS]` - Purple

**Improved Folder Icons:**
- Open folder icon shows document papers inside
- Closed folder icon for collapsed folders
- Theme-aware icons (light/dark mode support)
- Dynamic icon changes on expand/collapse

**Tree View Indicators:**
- → Arrow icon for active request (current tab)
- • Dot icon for other open requests
- Bold text for active requests
- • Dot after collection/folder names containing open requests

## 🗄️ Database Schema Updates

### New Tables

#### `folders`
```sql
CREATE TABLE folders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    collection_id INTEGER NOT NULL,
    parent_id INTEGER,
    name TEXT NOT NULL,
    created_at TEXT NOT NULL,
    FOREIGN KEY (collection_id) REFERENCES collections(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES folders(id) ON DELETE CASCADE
)
```

#### `collection_variables`
```sql
CREATE TABLE collection_variables (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    collection_id INTEGER NOT NULL,
    key TEXT NOT NULL,
    value TEXT,
    description TEXT,
    FOREIGN KEY (collection_id) REFERENCES collections(id) ON DELETE CASCADE,
    UNIQUE(collection_id, key)
)
```

### Modified Tables

#### `requests`
- Added `folder_id INTEGER` - Optional foreign key to `folders(id)`
- Supports CASCADE SET NULL on folder deletion

## 🔧 API Changes

### DatabaseManager

**New Methods:**
- `create_folder(collection_id, name, parent_id=None) -> int`
- `get_folders_by_collection(collection_id) -> List[Dict]`
- `get_folder(folder_id) -> Optional[Dict]`
- `update_folder(folder_id, name=None, parent_id=None)`
- `delete_folder(folder_id)`
- `move_request_to_folder(request_id, folder_id)`
- `get_requests_by_folder(folder_id, collection_id) -> List[Dict]`
- `create_collection_variable(collection_id, key, value, description="") -> int`
- `get_collection_variables(collection_id) -> Dict[str, str]`
- `get_collection_variables_with_metadata(collection_id) -> List[Dict]`
- `update_collection_variable(variable_id, key=None, value=None, description=None)`
- `delete_collection_variable(variable_id)`
- `delete_collection_variables_by_collection(collection_id)`

**Modified Methods:**
- `create_request()` - Added `folder_id` parameter

### EnvironmentManager

**Modified Methods:**
- `substitute_in_request()` - Added `extra_variables` parameter for collection variables

## 🐛 Bug Fixes

- Fixed dropdown icons to use flat SVG design without 3D borders
- Fixed folder icon persistence across theme switches
- Fixed request highlighting in nested folder structures
- Fixed cascade deletion for folders and their contents
- Fixed variable resolution order to respect collection > environment hierarchy
- Fixed empty open folder icon - now shows document papers for distinction

## 🧪 Test Coverage

- **Total Tests:** 391
- **Passing:** 365 (93.4%)
- **New Test Suites:**
  - `test_folders_and_collection_variables.py` - Comprehensive folder and variable testing
  - Tests for folder CRUD operations
  - Tests for nested folder structures
  - Tests for request organization in folders
  - Tests for collection variable management
  - Tests for variable resolution hierarchy
  - Tests for UI integration

## 📦 Assets

**New Icons:**
- `collection-icon.svg` / `collection-icon-dark.svg` - Briefcase icon for collections
- `folder-icon.svg` / `folder-icon-dark.svg` - Closed folder icons
- `folder-open-icon.svg` / `folder-open-icon-dark.svg` - Open folder icons with documents

## 🚀 Performance

- Optimized tree rendering with custom `RequestTreeItemDelegate`
- Recursive folder traversal with efficient caching
- Database indexes for folder and collection variable queries
- Minimal UI reflow with incremental updates

## 📚 Documentation Updates

- Added `V1.6.0_IMPLEMENTATION_SUMMARY.md`
- Updated `README.md` with folder and collection variable features
- Updated `CHANGELOG.md` with v1.6.0 changes
- Updated user guides with folder management examples

## 🔄 Migration Notes

- **Automatic Migration:** Existing databases will automatically upgrade when opening v1.6.0
- **No Data Loss:** All existing requests, collections, and environments preserved
- **Backward Compatible:** Requests without folders remain at collection root level
- **Folder Assignment:** Use "Move to" context menu to organize existing requests into folders

## 💡 Usage Tips

1. **Organize by API Domain:**
   ```
   📦 E-commerce API
     📁 Products
     📁 Orders
     📁 Payments
     📁 Users
   ```

2. **Version-Based Organization:**
   ```
   📦 My API
     📁 v1
       📁 Deprecated
     📁 v2
       📁 Stable
       📁 Beta
   ```

3. **Feature-Based Organization:**
   ```
   📦 Social Platform API
     📁 Posts
       📁 CRUD Operations
       📁 Reactions
       📁 Comments
     📁 Users
       📁 Authentication
       📁 Profile
       📁 Settings
   ```

4. **Collection Variables for Environments:**
   - Create separate collections for Dev/Staging/Prod
   - Use collection variables for environment-specific endpoints
   - Override with environment variables when needed

## 🎯 Known Limitations

- Bulk operations (select multiple requests) - Planned for v1.7.0
- Drag-and-drop folder organization - Planned for v1.7.0
- Folder-level test execution - Planned for v1.7.0
- Collection variable import/export - Planned for v1.7.0

## 🔮 What's Next (v1.7.0)

- Bulk operations for requests and folders
- Drag-and-drop organization
- Folder-level variables (local scope)
- Enhanced search with folder filtering
- Collection runner with folder-level execution
- Import/Export improvements for folders

## 🙏 Feedback

We're committed to making PostMini the best API testing tool for developers. Your feedback shapes our roadmap!

- GitHub Issues: https://github.com/yourusername/postmini/issues
- Email: feedback@postmini.dev
- Discord: https://discord.gg/postmini

---

**Download:** [PostMini v1.6.0 Installer](https://github.com/yourusername/postmini/releases/tag/v1.6.0)

**Full Changelog:** [CHANGELOG.md](../CHANGELOG.md)


