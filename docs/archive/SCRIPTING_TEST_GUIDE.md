# JavaScript Scripting Test Guide

## üöÄ Quick Start

### 1. Import the Test Collection

1. Open PostMini
2. Click **"Import Collection"** button (or File ‚Üí Import)
3. Select **`Scripting_Test_Collection.json`**
4. The collection "JavaScript Scripting Tests" will appear in your collections tree

### 2. Set Up Environment (Optional)

Create a new environment with these variables (or they'll be created automatically by scripts):
- `environment` = "development" (or "staging"/"production")
- `authToken` (will be generated by request #10)
- `userId` (will be extracted by request #2)

---

## üìã Test Scenarios

### Request #1: Basic Pre-request Script
**What it tests:**
- Setting environment variables
- Adding custom headers dynamically
- Console logging

**How to use:**
1. Send the request
2. Check the **Scripts** tab ‚Üí Console Output
3. Verify headers in response (look for `X-Request-Time`, `X-Request-ID`)

**Expected output:**
```
Pre-request script executed at: 2025-11-05T...
Timestamp: 1730829600000
‚úì Pre-request script completed in 15ms
```

---

### Request #2: Extract JSON Data
**What it tests:**
- Parsing JSON responses
- Extracting nested data
- Saving to environment variables
- Running custom test assertions

**How to use:**
1. Send the request to fetch user data
2. Check Scripts ‚Üí Console for extracted data
3. View Tests tab to see passing assertions
4. Check environment variables: `userId`, `userName`, `userEmail` should now be set

**Expected output:**
```
Extracted user data:
- ID: 1
- Name: Leanne Graham
- Email: Sincere@april.biz

--- Script Tests ---
  ‚úì Status code is 200
  ‚úì User has valid email
  ‚úì Response has required fields
```

---

### Request #3: POST with Dynamic Body
**What it tests:**
- Generating dynamic request body
- Random data generation
- POST request handling

**How to use:**
1. Send the request
2. Check Scripts ‚Üí Console to see generated body
3. Response will show the created post with ID

**Expected output:**
```
Generated POST data:
{
  "title": "Test Post 742",
  "body": "This post was created at 2025-11-05T...",
  "userId": 1,
  "timestamp": 1730829600000
}

Post created with ID: 101
```

---

### Request #4: Request Chaining
**What it tests:**
- Using variables from previous requests
- Variable substitution in URLs
- Request dependencies

**Prerequisites:**
- **MUST run Request #2 first** to set `userId` variable

**How to use:**
1. First run Request #2
2. Then run Request #4
3. It will use `{{userId}}` from Request #2

**Expected output:**
```
Using userId from previous request: 1
‚úì Request chaining successful!
Fetched user: Leanne Graham
```

**If you get an error:**
```
ERROR: userId not found! Run request #2 first.
```
‚Üí Go back and run Request #2

---

### Request #5: Response Time Tests
**What it tests:**
- Measuring response time
- Performance validation
- Timeout handling

**Note:** This request has a 1-second delay built-in

**How to use:**
1. Send the request (it will take ~1 second)
2. Check console for timing information

**Expected output:**
```
Response time: 1150ms
Total time: 1155ms
‚úì Fast response: 1150ms
```

---

### Request #6: Header Validation
**What it tests:**
- Validating response headers
- Extracting header data
- CORS header checking

**How to use:**
1. Send the request
2. Check console to see all response headers listed

**Expected output:**
```
Response headers:
  Content-Type: application/json
  Access-Control-Allow-Origin: *
  ...
‚úì Custom header received: test-value-123
```

---

### Request #7: Error Handling
**What it tests:**
- Handling HTTP errors (404)
- Error status validation
- Conditional logic based on status codes

**How to use:**
1. Send the request (it will return 404 - this is intentional!)
2. Check console for error handling

**Expected output:**
```
‚ùå Request failed with status: 404
Error handling complete.

--- Script Tests ---
  ‚úì Expected 404 error
  ‚úì Status is Not Found
```

---

### Request #8: Array Data Processing
**What it tests:**
- Processing array responses
- Iterating over multiple items
- Data aggregation and analysis

**How to use:**
1. Send the request to get list of users
2. Check console for analysis results

**Expected output:**
```
Total users: 10
Top 3 users:
  1. Leanne Graham
  2. Ervin Howell
  3. Clementine Bauch

Users by domain:
  april.biz: 1
  anastasia.net: 1
  ramiro.info: 1
  ...
```

---

### Request #9: UUID Generation
**What it tests:**
- Generating unique request IDs
- UUID format
- Request tracking

**How to use:**
1. Send the request
2. Check console for generated UUID
3. Each request will have a unique ID

**Expected output:**
```
Generated Request ID: 3f4a7b9c-1d2e-4f5a-8b7c-9d8e7f6a5b4c
Timestamp: 2025-11-05T10:30:45.123Z
‚úì UUID request tracking successful
```

---

### Request #10: Authentication Simulation
**What it tests:**
- Bearer token authentication
- Authorization header handling
- Token persistence

**How to use:**
1. Send the request (first time generates token)
2. Send again (uses existing token)
3. Check environment variable `authToken`

**Expected output:**
```
Generated new auth token: demo_token_abc123
‚úì Authorization header added
‚úì Successfully authenticated
Token: demo_token_abc123
```

---

### Request #11: Conditional Logic
**What it tests:**
- Environment-based logic
- Conditional header addition
- Multi-environment support

**How to use:**
1. Set environment variable `environment` to "development", "staging", or "production"
2. Send the request
3. Different headers will be added based on environment

**Expected outputs:**
- Development: üü¢ Running in DEVELOPMENT mode
- Staging: üü° Running in STAGING mode
- Production: üî¥ Running in PRODUCTION mode

---

### Request #12: Complex JSON Extraction
**What it tests:**
- Extracting deeply nested data
- Multiple data paths
- Complex object navigation

**How to use:**
1. Send the request
2. Check console to see all extracted nested data
3. Check environment variables for saved data

**Expected output:**
```
Extracted address:
  Street: Kulas Light
  City: Gwenborough
  Zipcode: 92998-3874
  Coordinates: (-37.3159, 81.1496)

Extracted company:
  Name: Romaguera-Crona
  Catch Phrase: Multi-layered client-server neural-net
```

---

## üéØ Testing Workflow

### Recommended Test Order:

1. **Request #1** - Basic pre-request script
2. **Request #2** - Extract data (sets up variables)
3. **Request #4** - Request chaining (uses data from #2)
4. **Request #3** - POST with dynamic body
5. **Request #10** - Authentication setup
6. **Request #5-12** - Test remaining features in any order

### Full Test Suite:
Run all 12 requests in order to see the complete feature set!

---

## üîç What to Look For

### In the Scripts Tab:
- **Pre-request Script Editor** (top section)
- **Post-response Script Editor** (bottom section)  
- **Console Output Panel** (at bottom, collapsible)

### After Sending a Request:
1. **Console Output** - Shows execution logs
2. **Tests Tab** - Shows test results from `pm.test()`
3. **Response** - Shows actual API response
4. **Environment Variables** - Updated by scripts

### Console Output Colors:
- üü¢ Green `[INFO]` - Normal logs
- üü° Yellow `[WARNING]` - Warnings
- üî¥ Red `[ERROR]` - Errors

---

## üí° Tips

1. **Open Console**: Always keep Console Output visible to see script execution
2. **Check Variables**: Use the Environment panel to see variables being set/updated
3. **Snippets**: Click the "Snippets" dropdown in Scripts tab for more examples
4. **Error Messages**: Console shows detailed error messages with line numbers
5. **Execution Time**: Check console for script execution time (usually 10-30ms)

---

## üß™ Advanced Testing

### Modify the Scripts:
1. Open any request
2. Go to **Scripts** tab
3. Edit the pre-request or post-response script
4. Try your own JavaScript code!

### Example Modifications:

**Change timestamp format:**
```javascript
const timestamp = new Date().toISOString();
pm.environment.set("timestamp", timestamp);
```

**Add multiple headers:**
```javascript
pm.request.headers.add({key: "X-Custom-1", value: "value1"});
pm.request.headers.add({key: "X-Custom-2", value: "value2"});
pm.request.headers.add({key: "X-Custom-3", value: "value3"});
```

**Complex test assertion:**
```javascript
pm.test("Advanced validation", function() {
    const data = pm.response.json();
    pm.expect(data).to.be.an("object");
    pm.expect(Object.keys(data).length).to.be.above(5);
    pm.expect(data.email).to.match(/@/);
});
```

---

## üêõ Troubleshooting

### Script doesn't execute:
- Check for JavaScript syntax errors in console
- Verify py-mini-racer is installed: `pip list | grep py-mini-racer`

### Variables not being set:
- Check console output for errors
- Verify script completed successfully (‚úì in console)
- Check Environment panel to see current variables

### Request chaining fails:
- Make sure prerequisite requests ran first
- Check that variables exist in environment
- Look for variable names in console output

### Tests failing:
- Check expected vs actual values in Tests tab
- Review console logs for details
- Verify API endpoint is accessible

---

## üìö Learn More

### Postman API Reference:
The `pm` object is compatible with Postman's API:
- `pm.environment.*` - Environment variables
- `pm.collectionVariables.*` - Collection variables
- `pm.request.*` - Request modification (pre-request only)
- `pm.response.*` - Response access (post-response only)
- `pm.test()` - Custom test assertions
- `pm.expect()` - Chai-style assertions
- `console.log()` - Debugging output

### Next Steps:
1. Import your own Postman collections with scripts
2. Write custom scripts for your APIs
3. Build complex multi-request workflows
4. Automate authentication flows
5. Extract and chain data between requests

---

**Happy Testing! üöÄ**

